<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memorix Diagnostic Page</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2c3e50;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    .section {
      margin-bottom: 20px;
    }
    .result {
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
      word-break: break-all;
    }
    .success { background-color: #d4edda; color: #155724; }
    .warning { background-color: #fff3cd; color: #856404; }
    .error { background-color: #f8d7da; color: #721c24; }
    button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 8px 16px;
      text-align: center;
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
      margin-right: 8px;
      margin-bottom: 8px;
    }
    button.warning-btn { background-color: #ffc107; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Memorix Diagnostic Page</h1>
    <p>This page helps diagnose issues with your Memorix deployment.</p>
    
    <div class="section">
      <h2>1. JavaScript Execution</h2>
      <p>Checking if JavaScript is running correctly...</p>
      <div id="js-result" class="result">Waiting...</div>
      <button onclick="testJavaScript()">Run Test</button>
    </div>
    
    <div class="section">
      <h2>2. Environment Variables</h2>
      <p>Checking environment variables...</p>
      <div id="env-result" class="result">Waiting...</div>
      <button onclick="checkEnvironment()">Check Variables</button>
    </div>
    
    <div class="section">
      <h2>3. Asset Loading</h2>
      <p>Checking if assets can be loaded correctly...</p>
      <div id="asset-result" class="result">Waiting...</div>
      <button onclick="checkAssets()">Check Assets</button>
    </div>
    
    <div class="section">
      <h2>4. API Connection</h2>
      <p>Testing connection to the backend API...</p>
      <div id="api-result" class="result">Waiting...</div>
      <div>
        <input type="text" id="api-url" placeholder="API URL" value="" style="padding: 8px; width: 300px; margin-bottom: 8px; display: block;">
        <button onclick="testApiConnection()">Test Connection</button>
      </div>
    </div>
    
    <div class="section">
      <h2>5. Browser Information</h2>
      <div id="browser-info" class="result">Checking browser information...</div>
      <button onclick="getBrowserInfo()">Get Info</button>
    </div>
    
    <div class="section">
      <h2>Actions</h2>
      <button onclick="window.location.href = '/'">Go to Homepage</button>
      <button onclick="clearLocalStorage()" class="warning-btn">Clear Local Storage</button>
      <button onclick="window.location.reload(true)" class="warning-btn">Hard Reload</button>
    </div>
  </div>

  <script>
    // Run basic tests on load
    window.onload = function() {
      testJavaScript();
      getBrowserInfo();
      
      // Try to get API URL from local storage or environment
      const storedApiUrl = localStorage.getItem('apiUrl');
      if (storedApiUrl) {
        document.getElementById('api-url').value = storedApiUrl;
      } else if (process && process.env && process.env.REACT_APP_API_URL) {
        document.getElementById('api-url').value = process.env.REACT_APP_API_URL;
      }
    };
    
    function testJavaScript() {
      const result = document.getElementById('js-result');
      try {
        const testObj = { test: 'success' };
        const json = JSON.stringify(testObj);
        const parsed = JSON.parse(json);
        
        if (parsed.test === 'success') {
          result.innerHTML = "JavaScript is running correctly!";
          result.className = "result success";
        } else {
          throw new Error('JSON parsing error');
        }
      } catch (e) {
        result.innerHTML = "JavaScript error: " + e.message;
        result.className = "result error";
      }
    }
    
    function checkEnvironment() {
      const result = document.getElementById('env-result');
      try {
        let envVars = "Environment variables:<br>";
        envVars += "NODE_ENV: " + (process && process.env && process.env.NODE_ENV ? process.env.NODE_ENV : "Not set") + "<br>";
        envVars += "REACT_APP_API_URL: " + (process && process.env && process.env.REACT_APP_API_URL ? process.env.REACT_APP_API_URL : "Not set") + "<br>";
        
        const missingVars = [];
        if (!process || !process.env || !process.env.REACT_APP_API_URL) {
          missingVars.push("REACT_APP_API_URL");
        }
        
        if (missingVars.length > 0) {
          result.innerHTML = envVars + "<br>Warning: The following environment variables are missing: " + missingVars.join(", ");
          result.className = "result warning";
        } else {
          result.innerHTML = envVars + "<br>All expected environment variables are set.";
          result.className = "result success";
        }
      } catch (e) {
        result.innerHTML = "Error checking environment: " + e.message;
        result.className = "result error";
      }
    }
    
    function checkAssets() {
      const result = document.getElementById('asset-result');
      result.innerHTML = "Checking assets...";
      result.className = "result";
      
      // Create an image to test static asset loading
      const img = new Image();
      img.onload = function() {
        result.innerHTML = "Successfully loaded favicon.ico";
        result.className = "result success";
      };
      img.onerror = function() {
        result.innerHTML = "Failed to load favicon.ico. Check your public path configuration.";
        result.className = "result error";
      };
      img.src = "favicon.ico";
    }
    
    function testApiConnection() {
      const result = document.getElementById('api-result');
      const apiUrl = document.getElementById('api-url').value;
      
      if (!apiUrl) {
        result.innerHTML = "Please enter the API URL to test.";
        result.className = "result warning";
        return;
      }
      
      // Save for future use
      localStorage.setItem('apiUrl', apiUrl);
      
      result.innerHTML = "Testing connection to " + apiUrl + "...";
      result.className = "result";
      
      // Use a test endpoint or just test if the server responds
      fetch(apiUrl, { 
        method: 'GET',
        headers: { 'Content-Type': 'application/json' },
        mode: 'cors'
      })
      .then(response => {
        if (response.ok) {
          result.innerHTML = "API connection successful! Status: " + response.status;
          result.className = "result success";
          return response.text();
        } else {
          throw new Error("API returned status code: " + response.status);
        }
      })
      .then(data => {
        result.innerHTML += "<br>Response: " + data.substring(0, 100) + (data.length > 100 ? "..." : "");
      })
      .catch(error => {
        result.innerHTML = "API connection failed: " + error.message + "<br>This may be due to CORS restrictions or the API being unavailable.";
        result.className = "result error";
      });
    }
    
    function getBrowserInfo() {
      const result = document.getElementById('browser-info');
      const info = "Browser: " + navigator.userAgent + "<br>" +
                  "Language: " + navigator.language + "<br>" +
                  "Window Size: " + window.innerWidth + "x" + window.innerHeight + "<br>" +
                  "URL: " + window.location.href + "<br>" +
                  "Protocol: " + window.location.protocol;
      result.innerHTML = info;
      result.className = "result";
    }
    
    function clearLocalStorage() {
      localStorage.clear();
      sessionStorage.clear();
      alert("Local storage and session storage have been cleared.");
    }
  </script>
</body>
</html>
